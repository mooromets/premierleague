---
title: "Red card factor"
author: "Sergey Sambor"
date: "September 9, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r dependencies}
source("../get_epl_data.r")
source("../reshape_data.r")
library(ggplot2)
```

Get data
```{r get data}
setwd("../data")
downloadSeasons(2007:2017,1)
data <- readSeasonsData(2007:2017, 1)
setwd("../reports")

data <- basicClean(data)
```

Reshape data
```{r}
# subset data
cards <- data %>% 
  select (FTR, HR, AR, BbAvH, BbAvA, field) %>% 
  filter (field == 'H')

# introduce advantage and oddsDiff variables
# oddsDiff - advantage in the odds for the opponent
cards <- cards %>% 
  mutate(oddsDiff = ifelse(HR >= AR, BbAvA - BbAvH, BbAvH - BbAvA),
         advantage = ifelse(HR == AR, FALSE, TRUE),
         FTR = ifelse((FTR == 'D') | (HR >= AR), 
                      FTR, 
                      ifelse(FTR == 'W', 'L', 'W'))) %>%
  filter(!is.na(oddsDiff))

cards %>% 
  select(oddsDiff, advantage, FTR) %>%
  group_by(FTR, advantage) %>%
  summarise(oddsAvg = mean(oddsDiff), oddsMed = median(oddsDiff))
```

Density plot
```{r}
ggplot(aes(oddsDiff, fill = advantage), data = cards)+
  geom_density(alpha=0.25) + 
  facet_grid(. ~ FTR)
```